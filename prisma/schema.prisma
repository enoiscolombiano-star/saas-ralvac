generator client {  
  provider = "prisma-client-js"  
  output   = "../src/generated/prisma"  
}  
  
datasource db {  
  provider = "postgresql"  
}  
  
enum TaskStatus {  
  CRIADA  
  EM_PRODUCAO  
  PRONTA_PARA_TESTES  
}  
  
enum AdType {  
  NOVO  
  EDICAO_VSL  
}  
  
enum WebhookEvent {  
  TASK_CREATED  
  TASK_UPDATED  
  TASK_STATUS_CHANGED  
  AD_PUBLISHED  
}  
  
enum AdStatus {  
  RASCUNHO  
  VEICULADO  
  PAUSADO  
  FINALIZADO  
}  
  
enum UserRole {  
  ADMIN  
  EDITOR  
  VIEWER  
}  
  
model Task {  
  id           String     @id @default(cuid())  
  nomeCompleto String     @map("nome_completo")  
  prefixo      String  
  status       TaskStatus @default(CRIADA)  
  criadoPor    String?    @map("criado_por")  
  comQuem      String?    @map("com_quem")  
  prazo        DateTime?  
  criadoEm     DateTime   @default(now()) @map("criado_em")  
  atualizadoEm DateTime   @updatedAt @map("atualizado_em")  
    
  definition   TaskDefinition?  
  utmConfigs   UTMConfig[]  
  ads          Ad[]  
    
  @@index([status])  
  @@index([criadoEm])  
  @@map("tasks")  
}  
  
model TaskDefinition {  
  id              String   @id @default(cuid())  
  taskId          String   @unique @map("task_id")  
  modeloAnuncio   String   @map("modelo_anuncio")  
  tipoEdicao      AdType   @map("tipo_edicao")  
  criadoEm        DateTime @default(now()) @map("criado_em")  
  atualizadoEm    DateTime @updatedAt @map("atualizado_em")  
    
  task            Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)  
    
  @@map("task_definitions")  
}  
  
model UTMConfig {  
  id              String   @id @default(cuid())  
  taskId          String   @map("task_id")  
  campaignName    String   @map("campaign_name")  
  funcao          String?  
  copy            String?  
  lead            String?  
  editor          String?  
  hook            String?  
  persona         String?  
  criadoEm        DateTime @default(now()) @map("criado_em")  
  atualizadoEm    DateTime @updatedAt @map("atualizado_em")  
    
  task            Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)  
    
  @@index([taskId])  
  @@map("utm_configs")  
}  
  
model Webhook {  
  id        String         @id @default(cuid())  
  nome      String  
  url       String  
  eventos   WebhookEvent[]  
  ativo     Boolean        @default(true)  
  secret    String?  
  criadoEm  DateTime       @default(now()) @map("criado_em")  
    
  logs      WebhookLog[]  
    
  @@map("webhooks")  
}  
  
model WebhookLog {  
  id         String   @id @default(cuid())  
  webhookId  String   @map("webhook_id")  
  statusCode Int      @map("status_code")  
  response   String?  
  criadoEm   DateTime @default(now()) @map("criado_em")  
    
  webhook    Webhook  @relation(fields: [webhookId], references: [id])  
    
  @@map("webhook_logs")  
}  
  
model Ad {  
  id           String    @id @default(cuid())  
  taskId       String    @map("task_id")  
  titulo       String  
  descricao    String?  
  linkBase     String    @map("link_base")  
  linkGerado   String    @map("link_gerado")  
  status       AdStatus  @default(RASCUNHO)  
  criadoEm     DateTime  @default(now()) @map("criado_em")  
  atualizadoEm DateTime  @updatedAt @map("atualizado_em")  
    
  task         Task      @relation(fields: [taskId], references: [id])  
  metrics      AdMetric[]  
    
  @@index([taskId])  
  @@index([status])  
  @@map("ads")  
}  
  
model AdMetric {  
  id         String   @id @default(cuid())  
  adId       String   @map("ad_id")  
  impressoes Int      @default(0)  
  cliques    Int      @default(0)  
  conversoes Int      @default(0)  
  gastoTotal Float    @default(0) @map("gasto_total")  
  criadoEm   DateTime @default(now()) @map("criado_em")  
    
  ad         Ad       @relation(fields: [adId], references: [id])  
    
  @@index([adId])  
  @@map("ad_metrics")  
}  
  
model User {  
  id        String    @id @default(cuid())  
  nome      String  
  email     String    @unique  
  senha     String  
  role      UserRole  @default(VIEWER)  
  ativo     Boolean   @default(true)  
  criadoEm  DateTime  @default(now()) @map("criado_em")  
    
  sessions  Session[]  
  auditLogs AuditLog[]  
    
  @@map("users")  
}  
  
model Session {  
  id        String   @id @default(cuid())  
  userId    String   @map("user_id")  
  token     String   @unique  
  expiresAt DateTime @map("expires_at")  
  criadoEm  DateTime @default(now()) @map("criado_em")  
    
  user      User     @relation(fields: [userId], references: [id])  
    
  @@map("sessions")  
}  
  
model AuditLog {  
  id         String   @id @default(cuid())  
  userId     String   @map("user_id")  
  entityType String   @map("entity_type")  
  entityId   String   @map("entity_id")  
  action     String  
  changes    Json?  
  criadoEm   DateTime @default(now()) @map("criado_em")  
    
  user       User     @relation(fields: [userId], references: [id])  
    
  @@index([entityType, entityId])  
  @@map("audit_logs")  
}